<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>内部記録検索端末</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="terminal">
    <h1>内部記録検索端末</h1>

    <input id="query" type="text" placeholder="キーワードを入力" autofocus>
    <button id="searchBtn">SEARCH</button>

    <div id="results"></div>
  </div>

<script>
  // 検索欄・ボタン・結果エリア
  const input  = document.getElementById('query');
  const btn    = document.getElementById('searchBtn');
  const result = document.getElementById('results');

  // ★ここを自分の GAS の exec URL に置き換える
  const API_URL = "https://script.google.com/macros/s/AKfycbzIH0umiGa1lpoQQvOc8D7u3ed0QXRdguQVt59ClRJdQqoGCnGjM0uaj1MS20-BdxdGFg/exec";

  // ======================
  // 検索実行処理（GAS に問い合わせ）
  // ======================
  async function search() {
    const q = input.value.trim();
    result.innerHTML = "";

    if (!q) return;

    try {
      const res  = await fetch(API_URL + "?key=" + encodeURIComponent(q));
      const data = await res.json();

      if (data.error) {
        // エラー種別でメッセージ分けてもよい
        result.innerHTML = "<p>該当データは見つかりませんでした。</p>";
        return;
      }

      // data = { title, body } を1件として描画
      renderDoc(data);

    } catch (e) {
      console.error(e);
      result.innerHTML = "<p>通信エラーが発生しました。</p>";
    }
  }

  // ======================
  // 1件分の結果を表示
  // タイトルクリックで新しいタブを開く
  // ======================
  function renderDoc(doc) {
    result.innerHTML = "";

    const div = document.createElement("div");
    div.className = "hit";

    // 冒頭だけ抜き出してスニペットにする
    const snippet = doc.body.trim().slice(0, 80) + "…";

    div.innerHTML = `
      <h2 class="doc-title" style="cursor:pointer; text-decoration:underline;">
        ${doc.title}
      </h2>
      <p class="snippet">${snippet}</p>
    `;

    // タイトルをクリックしたら新タブで全文表示
    const titleEl = div.querySelector(".doc-title");
    titleEl.addEventListener("click", () => {
      const win = window.open("", "_blank");
      if (!win) return; // ポップアップブロック対策

      win.document.write(`
        <!doctype html>
        <html lang="ja">
        <head>
          <meta charset="UTF-8">
          <title>${doc.title}</title>
        </head>
        <body style="white-space:pre-wrap; background:#0c1525; color:#e4f2ff; font-family:monospace; padding:20px;">
          <h2>${doc.title}</h2>
          ${doc.body}
        </body>
        </html>
      `);
      win.document.close();
    });

    result.appendChild(div);
  }

  // ======================
  // イベント設定
  // ======================
  btn.addEventListener("click", search);
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") search();
  });
</script>

  
</body>
</html>
