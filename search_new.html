<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>データベース検索 - 金枝聖域第八病院</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>内部アーカイブ検索</h1>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="キーワードを入力してください...">
            <button onclick="executeSearch()">実行</button>
        </div>
        <div id="results"></div>
    </div>

    <script>
    async function executeSearch() {
        const keyword = document.getElementById('searchInput').value.trim();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = "検索中...";

        if (!keyword) {
            resultsDiv.innerHTML = "キーワードを入力してください。";
            return;
        }

        try {
            // 1. キーワードをSHA-256ハッシュに変換
            const msgUint8 = new TextEncoder().encode(keyword);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            
            // 各バイトを必ず2桁の16進数文字列に変換 (修正ポイント)
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            // 2. ハッシュ値をファイル名としてfetch
            const response = await fetch(`./data/${hashHex}.json`);
            
            if (!response.ok) {
                throw new Error('Not Found');
            }

            const data = await response.json();

            // 3. 結果の表示
            resultsDiv.innerHTML = `
                <div class="result-item" style="margin-top:20px; border:1px solid #ccc; padding:10px;">
                    <h3>${data.title}</h3>
                    <p>${data.description}</p>
                    <a href="${data.url}">詳細を閲覧</a>
                </div>
            `;
        } catch (error) {
            resultsDiv.innerHTML = "該当する記録は見つかりませんでした。";
        }
    }
</script>
</body>
</html>
